<div class="d-flex justify-content-center align-items-start min-vh-100 p-4"
     style="background: linear-gradient(135deg, #6237A0, #DEACF5); background-attachment: fixed;">

  <div class="container" style="max-width: 1000px;">

    <!-- Back Button -->
    <div class="mb-4">
      <button (click)="goBack()" 
              class="btn btn-outline-secondary fw-semibold"
              style="background: linear-gradient(90deg, #6237A0, #9754CB);; color: white; border-radius: 0.5rem;">
        â¬… Back to My Groups
      </button>
    </div>

    <!-- Super Admin Dashboard -->
    <div class="card shadow-lg border-0 mb-4" style="border-radius: 1rem;">
      <div class="card-header text-white fw-bold"
           style="background: linear-gradient(90deg, #6237A0, #9754CB); border-radius: 1rem 1rem 0 0;">
        Super Admin Dashboard
      </div>
      <div class="card-body">

        <!-- Create Group Form -->
        <form (ngSubmit)="addGroup()" class="mb-4">
          <div class="mb-3">
            <label for="groupName" class="form-label fw-semibold">New Group</label>
            <input id="groupName"
                   type="text"
                   [ngModel]="groupName()"
                   (ngModelChange)="groupName.set($event)"
                   name="groupName"
                   class="form-control"
                   placeholder="Enter group name" />
          </div>
          <button type="submit" 
                  class="btn fw-semibold text-white"
                  style="background: linear-gradient(90deg, #6237A0, #9754CB); border: none; border-radius: 0.5rem;">
            Create Group
          </button>
        </form>

        <!-- Groups -->
        <h5 class="fw-bold mb-3">Groups</h5>
        <ul class="list-group">
          @for(g of groups; track $index) {
            <li class="list-group-item mb-3" style="border-radius: 0.5rem;">
              <h6 class="fw-bold">{{ g.name }}</h6>
              <p><b>Admins:</b> {{ g.admins.join(', ') }}</p>

              <!-- Members -->
              <p class="mb-1"><b>Members:</b></p>
              <ul class="ms-3">
                @for(m of g.members; track $index) {
                  <li class="mb-1">
                    {{ m }}

                    <!-- Promote chatUser -> groupAdmin -->
                    @if(!g.admins.includes(m) && !superAdmins.includes(m)) {
                      <button (click)="promoteUser(g.id, m, 'groupAdmin')" 
                              class="btn btn-sm btn-outline-secondary me-1"
                              style="border-color: #9754CB; color: #6237A0; border-radius: 0.5rem;">
                        Promote to Group Admin
                      </button>
                    }

                    <!-- Promote to Super Admin -->
                    @if(!superAdmins.includes(m)) {
                      <button (click)="promoteUser(g.id, m, 'superAdmin')" 
                              class="btn btn-sm fw-semibold text-white me-1"
                              style="background: linear-gradient(90deg, #6237A0, #9754CB); border: none; border-radius: 0.5rem;">
                        Promote to Super Admin
                      </button>
                    }

                    <!-- Remove -->
                    <button (click)="removeMember(g.id, m)" 
                            class="btn btn-sm btn-outline-secondary me-1"
                            style="border-color: #9754CB; color: #6237A0; border-radius: 0.5rem;">
                      Remove from Group
                    </button>

                    <!-- Ban -->
                    <button (click)="banMember(g.id, m)" 
                            class="btn btn-sm text-white"
                            style="background: #dc3545; border: none; border-radius: 0.5rem;">
                      Ban
                    </button>
                  </li>
                }
              </ul>

              <!-- Banned Members -->
              <p class="mt-3 mb-1"><b>Banned Members:</b></p>
              <ul class="ms-3">
                @for(b of g.bannedMembers; track $index) {
                  <li><span class="badge bg-danger">{{ b }}</span></li>
                }
              </ul>

              <!-- Join Requests -->
              <p class="mt-3 mb-1"><b>Join Requests:</b></p>
              <ul class="ms-3">
                @for(r of g.joinRequests; track $index) {
                  <li class="mb-1">
                    {{ r }}
                    <button (click)="approveJoin(g.id, r)" 
                            class="btn btn-sm fw-semibold text-white me-1"
                            style="background: linear-gradient(90deg, #6237A0, #9754CB); border: none; border-radius: 0.5rem;">
                      Approve
                    </button>
                    <button (click)="declineJoin(g.id, r)" 
                            class="btn btn-sm btn-outline-secondary"
                            style="border-color: #9754CB; color: #6237A0; border-radius: 0.5rem;">
                      Decline
                    </button>
                  </li>
                }
              </ul>

              <!-- Reports -->
              <h6 class="mt-3 fw-bold">Reports</h6>
              <ul class="ms-3">
                @for(r of reports(); track $index) {
                  <li class="mb-2">
                    <strong>Member:</strong> {{ r.member }} <br />
                    <strong>Reported by:</strong> {{ r.reportedBy }} <br />
                    <strong>Group:</strong> {{ r.groupId }} <br />
                    <strong>Reason:</strong> {{ r.text }} <br />
                    <em>{{ r.timestamp | date:'short' }}</em>
                  </li>
                }
              </ul>

              <!-- Delete Group -->
              <button (click)="deleteGroup(g.id)" 
                      class="btn btn-sm text-white mt-2"
                      style="background: #dc3545; border: none; border-radius: 0.5rem;">
                Delete Group
              </button>

              <!-- Channels -->
              <p class="mt-3 mb-1"><b>Channels:</b></p>
              <ul class="ms-3">
                @for(c of g.channels; track $index) {
                  <li class="mb-2">
                    <strong>{{ c.name }}</strong>
                    <p class="mb-1">Members: {{ (c.users || []).join(', ') || 'No members yet' }}</p>

                    @if(g.admins.includes(currentUser?.username || '') || currentUser?.roles?.includes('superAdmin')) {
                      <button (click)="deleteChannel(g.id, c.id)" 
                              class="btn btn-sm text-white"
                              style="background: #dc3545; border: none; border-radius: 0.5rem;">
                        Delete Channel
                      </button>
                    }
                  </li>
                }
              </ul>

              <!-- Create Channel -->
              @if(g.admins.includes(currentUser?.username || '') || currentUser?.roles?.includes('superAdmin')) {
                <div class="mt-2">
                  <input #channelName placeholder="New channel name" class="form-control d-inline w-auto me-2" />
                  <button (click)="createChannel(g.id, channelName.value)" 
                          class="btn fw-semibold text-white"
                          style="background: linear-gradient(90deg, #6237A0, #9754CB); border: none; border-radius: 0.5rem;">
                    Create Channel
                  </button>
                </div>
              }
            </li>
          }
        </ul>

      </div>
    </div>
  </div>
</div>
