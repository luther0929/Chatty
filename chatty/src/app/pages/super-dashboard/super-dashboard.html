<button (click)="goBack()">â¬… Back to My Groups</button>
<h2>Super Admin Dashboard</h2>

<form (ngSubmit)="addGroup()">
  <label for="groupName">New Group</label>
  <input
    id="groupName"
    type="text"
    [ngModel]="groupName()"
    (ngModelChange)="groupName.set($event)"
    name="groupName"
  />
  <button type="submit">Create Group</button>
</form>

<h3>Groups</h3>
<ul>
  @for(g of groups; track $index) {
    <li>
      <strong>{{ g.name }}</strong>
      <p><b>Admins:</b> {{ g.admins.join(', ') }}</p>
      <p><b>Members:</b></p>
      <ul>
        @for(m of g.members; track $index) {
          <li>
            {{ m }}

            <!-- Promote chatUser -> groupAdmin -->
            @if(!g.admins.includes(m) && !superAdmins.includes(m)) {
              <button (click)="promoteUser(g.id, m, 'groupAdmin')">
                Promote to Group Admin
              </button>
            }

            <!-- Promote chatUser or groupAdmin -> superAdmin -->
            @if(!superAdmins.includes(m)) {
              <button (click)="promoteUser(g.id, m, 'superAdmin')">
                Promote to Super Admin
              </button>
            }

            <!-- Remove member -->
            <button (click)="removeMember(g.id, m)">
              Remove from Group
            </button>
            <!-- Ban member -->
            <button (click)="banMember(g.id, m)">Ban</button>
          </li>
        }
      </ul>

      <p><b>Banned Members:</b></p>
      <ul>
        @for(b of g.bannedMembers; track $index) {
          <li>{{ b }}</li>
        }
      </ul>

      <p><b>Join Requests:</b></p>
      <ul>
        @for(r of g.joinRequests; track $index) {
          <li>
            {{ r }}
            <button (click)="approveJoin(g.id, r)">Approve</button>
            <button (click)="declineJoin(g.id, r)">Decline</button>
          </li>
        }
      </ul>

      <h3>Reports</h3>
      <ul>
        @for(r of reports(); track $index) {
          <li>
            <strong>Member:</strong> {{ r.member }} <br />
            <strong>Reported by:</strong> {{ r.reportedBy }} <br />
            <strong>Group:</strong> {{ r.groupId }} <br />
            <strong>Reason:</strong> {{ r.text }} <br />
            <em>{{ r.timestamp | date:'short' }}</em>
          </li>
        }
      </ul>

      <button (click)="deleteGroup(g.id)">Delete Group</button>

      <p><b>Channels:</b></p>
      <ul>
        @for(c of g.channels; track $index) {
          <li>
            <strong>{{ c.name }}</strong>

            <!-- Members list -->
            <p>Members: {{ (c.users || []).join(', ') || 'No members yet' }}</p>

            <!-- Delete button only for admins/super admins -->
            @if(
              g.admins.includes(currentUser?.username || '') ||
              currentUser?.roles?.includes('superAdmin')
            ) {
              <button (click)="deleteChannel(g.id, c.id)">Delete Channel</button>
            }
          </li>
        }
      </ul>

      <!-- Channel creation form -->
      @if(
        g.admins.includes(currentUser?.username || '') ||
        currentUser?.roles?.includes('superAdmin')
      ) {
        <input #channelName placeholder="New channel name" />
        <button (click)="createChannel(g.id, channelName.value)">Create Channel</button>
      }
    </li>
  }
</ul>

